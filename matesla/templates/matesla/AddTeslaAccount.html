<!--{% extends 'base.html' %}-->
{% load i18n %}
{% block content %}
<div class="form-group">
    <a href="{% url 'logout' %}" class="btn btn-danger btn-sm">{% trans 'logout' %}</a>
    <a href="{% url 'AnonymisedStatsChoicePage' %}" class="btn btn-info btn-sm">{% trans 'Firmware and cars Stats' %}</a>
    <a href="https://github.com/mehdirahbe/matesla" target="_blank" class="btn btn-primary btn-sm">Matesla Github</a>
</div>
<div class="input-group mb-3">
    <div class="input-group-prepend">
        <form action="{% url 'AddTeslaAccount' %}" method="post">
            {% csrf_token %}
            <div class="input-group-text"><p>{% trans 'Please either enter (one of the 2 methods):' %}<BR/>
                {% trans 'a) your tesla credentials: user and password (recommanded method)'%}<BR/>
                {% trans 'b) A token (advanced users)'%}<BR/>
                <BR/>{% trans 'If you submit your user, we will use it to generate a token and your user will NOT be stored.' %}
                <BR/><BR/>{% trans 'The token allow to connect to your Tesla car, it does expire after 45 days.' %}
                <BR/><B>{% trans 'The token alone does not allow to put your car in drive mode.' %}</B>
                <BR/>{% trans 'Token is invalidated if you change your tesla password.' %}
                <BR/><BR/>{% trans 'If you did choose to provide a token, optionally, you can also provide token creation date to know when the token will expire.' %}
                <BR/>{% trans 'The optional refresh token then allow to get automatically a new one from Tesla.' %}
                <BR/><BR/>{% trans 'If you only fill the token, we have no way to renew it, and this form will be presented again at expiration.' %}</p>
            </div>
            {{ tesla_account_form }}
            <input type="submit" value="{% trans 'Save' %}" class="btn btn-primary">
        </form>
    </div>
    <div class="form-group">
        <p>{% trans 'For advanced users: you can run in any python console this code to obtain your token, refresh and creation time.' %}
            <BR/>{% trans 'You have to install '%}
            <a href="https://www.python.org/downloads/" target="_blank">Python</a>
                {% trans ' and '%}
                <a href="https://requests.readthedocs.io/en/master/user/install" target="_blank">Requests</a>
            {% trans ' package first.'%}</p>
            <p>import requests<BR/>
            import json<BR/>
            client_id = &#39;81527cff06843c8634fdc09e8ac0abefb46ac849f38fe1e431c2ef2106796384&#39;<BR/>
            client_secret = &#39;c7257eb71a564034f9419ee651c7d0e5f7aa6bfbd18bafb5c5c033b093bb2fa3&#39;<BR/>
            token_url = &#34;https://owner-api.teslamotors.com/oauth/token&#34;<BR/>
            data = {&#39;grant_type&#39;: &#39;password&#39;, &#39;client_id&#39;: client_id, &#39;client_secret&#39;:
            client_secret,&#39;email&#39;: &#39;<B>PUT HERE YOUR TESLA USER</B>&#39;, &#39;password&#39;: &#39;<B>PUT HERE YOUR TESLA
            PASSWORD</B>'}<BR/>
            access_token_response = requests.post(token_url, data=data, verify=True, allow_redirects=False)<BR/>
            tokens = json.loads(access_token_response.text)<BR/>
            print(&#34;access_token is &#34;+tokens[&#34;access_token&#34;])<BR/>
            print(&#34;created_at is &#34;+str(tokens[&#34;created_at&#34;]))<BR/>
            print(&#34;refresh_token is &#34;+tokens[&#34;refresh_token&#34;])<BR/>
        </p>
    </div>
{% endblock %}